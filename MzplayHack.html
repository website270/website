<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mzplay Digits Predictor</title>
<style>
  :root { --size:28px; --gap:8px; --font:"Segoe UI",Roboto,Arial,sans-serif; }
  body { font-family:var(--font); background:#f6f7fb; margin:18px; color:#111; }
  h1 { margin:0 0 6px; font-size:16px; }
  p.sub { margin:0 0 10px; color:#555; font-size:13px; }
  .wrap { display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap; }
  .left { background:#fff; padding:12px; border-radius:10px; box-shadow:0 6px 18px rgba(10,10,20,0.06); }
  .chart { width:420px; padding:8px 14px; position:relative; overflow:auto; max-height:520px; }
  .row { display:grid; grid-template-columns:repeat(10,var(--size)); gap:var(--gap); align-items:center; margin:8px 0; position:relative; justify-content:center; }

  .digit {
    width:var(--size); height:var(--size);
    border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    font-weight:700; color:#111; cursor:pointer;
    border:1px solid #ddd;
    background:#fff;
    transition:background 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
    user-select:none;
    box-sizing:border-box;
  }

  .digit.active.green { background:#6fcf97; box-shadow:0 0 10px 3px rgba(111,207,151,0.55); color:#fff; }
  .digit.active.red { background:#eb5757; box-shadow:0 0 10px 3px rgba(235,87,87,0.55); color:#fff; }
  .digit.active.gradient-redviolet {
    background:linear-gradient(90deg,#eb5757 0%, #bb6bd9 100%);
    box-shadow:0 0 10px 3px rgba(187,107,217,0.45);
    color:#fff;
  }
  .digit.active.gradient-greenviolet {
    background:linear-gradient(90deg,#6fcf97 0%, #bb6bd9 100%);
    box-shadow:0 0 10px 3px rgba(111,207,151,0.45);
    color:#fff;
  }

  svg.lines { position:absolute; top:0; left:0; pointer-events:none; overflow:visible; }

  .controls { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
  button { padding:7px 12px; border-radius:8px; font-weight:700; border:none; cursor:pointer; transition:opacity 0.15s ease; }
  button:hover { opacity:0.85; }
  button.primary { background:#2b8bf2; color:#fff; }
  button.secondary { background:#f3f4f6; color:#222; border:1px solid #e6e7eb; }

  .right { width:220px; min-height:140px; background:#fff; padding:12px; border-radius:10px; box-shadow:0 6px 18px rgba(10,10,20,0.06);
    display:flex; flex-direction:column; align-items:flex-start; justify-content:center; }
  .label-min { font-size:12px; color:#666; margin-bottom:6px; }
  .result-big { font-size:48px; font-weight:900; line-height:1; margin:6px 0; }
  .up { color:#2b8bf2; }
  .down { color:#e74c3c; }
  .dir { font-weight:800; margin-top:6px; }
  footer { margin-top:10px; font-size:11px; color:#777; }
  .muted { color:#666; font-size:13px; }
</style>
</head>
<body>
  <h1>Mzplay Digits Predictor</h1>
  <p class="sub">Click digits from the <strong>bottom row up</strong> (bottom = oldest, top = newest). Fill all <b>10</b> rows, then press <b>Analyze → Predict</b>.</p>

  <div class="wrap">
    <div class="left">
      <div id="chart" class="chart" aria-label="digit chart">
        <svg class="lines" id="lines"></svg>
      </div>

      <div class="controls">
        <button class="primary" id="analyzeBtn">Analyze → Predict</button>
        <button class="secondary" id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="right" aria-live="polite">
      <div class="label-min">Predicted next digit</div>
      <div id="resultBox" style="display:flex;flex-direction:column;align-items:flex-start;">
        <div class="result-big" id="predicted">—</div>
        <div class="dir muted" id="dirText"></div>
      </div>
      <div style="height:8px"></div>
      <div class="muted">Only final prediction shown (Mzplay logic hidden).</div>
      <footer>Demo — not financial advice.</footer>
    </div>
  </div>

<script>
/* 
Mzplay Digits Predictor (v9)
This tool internally evaluates structure, BOS, ChoCH, FVG, OB to infer bias.
Only final prediction (UP / DOWN / SKIP) is shown. 
*/

const ROWS = 10;
const chart = document.getElementById('chart');
const svg = document.getElementById('lines');
const analyzeBtn = document.getElementById('analyzeBtn');
const resetBtn = document.getElementById('resetBtn');
const predictedEl = document.getElementById('predicted');
const dirTextEl = document.getElementById('dirText');
const rows = [];
const selected = new Array(ROWS).fill(null);

function getColorClass(d){
  if([1,3,7,9].includes(d)) return 'green';
  if([2,4,6,8].includes(d)) return 'red';
  if(d===0) return 'gradient-redviolet';
  if(d===5) return 'gradient-greenviolet';
  return 'red';
}

/* build chart */
for(let r=0;r<ROWS;r++){
  const row=document.createElement('div');
  row.className='row';
  for(let d=0;d<10;d++){
    const el=document.createElement('div');
    el.className='digit';
    el.textContent=d;
    el.dataset.row=r;
    el.dataset.digit=d;
    el.dataset.color=getColorClass(d);
    el.addEventListener('click',()=>onPick(r,d,el));
    row.appendChild(el);
  }
  chart.appendChild(row);
  rows.push(row);
}

/* center for SVG line */
function center(el){
  const rect=chart.getBoundingClientRect(),r=el.getBoundingClientRect();
  return {x:(r.left+r.right)/2-rect.left+chart.scrollLeft,y:(r.top+r.bottom)/2-rect.top+chart.scrollTop};
}

/* redraw red line */
function redrawLines(){
  while(svg.firstChild)svg.removeChild(svg.firstChild);
  const pts=[];
  for(let r=0;r<ROWS;r++){
    const v=selected[r];
    if(v!==null){
      const node=rows[r].querySelector(`.digit[data-digit="${v}"]`);
      if(node)pts.push(center(node));
    }
  }
  if(pts.length<2)return;
  svg.setAttribute('width',chart.scrollWidth);
  svg.setAttribute('height',chart.scrollHeight);
  svg.setAttribute('viewBox',`0 0 ${chart.scrollWidth} ${chart.scrollHeight}`);
  const ns='http://www.w3.org/2000/svg';
  const poly=document.createElementNS(ns,'polyline');
  poly.setAttribute('points',pts.map(p=>`${p.x},${p.y}`).join(' '));
  poly.setAttribute('fill','none');
  poly.setAttribute('stroke','#e74c3c');
  poly.setAttribute('stroke-width','2.5');
  poly.setAttribute('stroke-linecap','round');
  poly.setAttribute('stroke-linejoin','round');
  svg.appendChild(poly);
}

/* digit selection */
function onPick(rowIndex,digit,el){
  rows[rowIndex].querySelectorAll('.digit').forEach(d=>{
    d.classList.remove('active','green','red','gradient-redviolet','gradient-greenviolet');
  });
  el.classList.add('active',el.dataset.color);
  selected[rowIndex]=digit;
  redrawLines();
}

/* collect all 10 */
function collectSeries(){
  const series=[];
  for(let i=ROWS-1;i>=0;i--){
    const v=selected[i];
    if(v===null)return null;
    series.push(v);
  }
  return series;
}

/* internal detection functions (formerly smc) */
function findSwings(series){
  const highs=[],lows=[];
  for(let i=1;i<series.length-1;i++){
    if(series[i]>series[i-1]&&series[i]>series[i+1])highs.push({i,val:series[i]});
    if(series[i]<series[i-1]&&series[i]<series[i+1])lows.push({i,val:series[i]});
  }
  return{highs,lows};
}
function detectStructure(series){
  const {highs,lows}=findSwings(series);
  let s={trend:0};
  if(highs.length>=2&&lows.length>=2){
    const h1=highs[highs.length-2].val,h2=highs[highs.length-1].val,l1=lows[lows.length-2].val,l2=lows[lows.length-1].val;
    if(h2>h1&&l2>l1)s.trend=1;
    else if(h2<h1&&l2<l1)s.trend=-1;
  }else{
    const n=series.length;
    if(n>=3){
      const [a,b,c]=series.slice(-3);
      if(b>a&&c>b)s.trend=1;
      if(b<a&&c<b)s.trend=-1;
    }
  }
  return s;
}
function detectBOS(series){
  const n=series.length; if(n<3)return 0;
  const prevHigh=Math.max(...series.slice(0,n-1)),prevLow=Math.min(...series.slice(0,n-1));
  const last=series[n-1],prev=series[n-2];
  if(last>prevHigh&&last>prev)return 1;
  if(last<prevLow&&last<prev)return -1;
  return 0;
}
function detectChoCH(series){
  const s=detectStructure(series),b=detectBOS(series);
  if(s.trend>0&&b===-1)return -1;
  if(s.trend<0&&b===1)return 1;
  return 0;
}
function detectFVG(series){
  for(let i=0;i<series.length-1;i++){
    const a=series[i],b=series[i+1];
    if(Math.abs(b-a)>=2)return b>a?1:-1;
  }
  return 0;
}
function detectOB(series){
  for(let i=series.length-2;i>=1;i--){
    const p=series[i-1],c=series[i],n=series[i+1];
    if(c<p&&c<n)return 1;
    if(c>p&&c>n)return -1;
  }
  return 0;
}
function computeMzplayBias(series){
  const s=detectStructure(series),bos=detectBOS(series),choch=detectChoCH(series),fvg=detectFVG(series),ob=detectOB(series);
  let score=0;
  score+=s.trend*0.5;
  score+=bos*0.35;
  score+=choch*-0.6;
  score+=fvg*0.25;
  score+=ob*0.2;
  if(Math.abs(score)<1e-6)score=0;
  return score;
}

/* prediction */
function analyzeMzplay(series){
  const n=series.length;
  if(n<3)return{pred:null,dir:0};
  const bias=computeMzplayBias(series);
  if(bias===0)return{pred:null,dir:0};
  const dir=bias>0?1:-1;
  let pred=series[n-1];
  if(dir===1)pred=Math.min(9,pred+3);else pred=Math.max(0,pred-3);
  return{pred,dir};
}

/* buttons */
analyzeBtn.onclick=()=>{
  const s=collectSeries();
  if(!s){predictedEl.textContent='—';dirTextEl.textContent='Please fill all 10 digits first.';return;}
  const r=analyzeMzplay(s);
  if(r.dir===0){predictedEl.textContent='—';dirTextEl.textContent='⚠️ Market structure unclear — prediction skipped.';return;}
  predictedEl.textContent=r.pred;
  if(r.dir===1){predictedEl.className='result-big up';dirTextEl.textContent='▲ Predicted UP (newest +3)';}
  else{predictedEl.className='result-big down';dirTextEl.textContent='▼ Predicted DOWN (newest −3)';}
};
resetBtn.onclick=()=>{
  for(let r=0;r<ROWS;r++){
    selected[r]=null;
    rows[r].querySelectorAll('.digit').forEach(d=>d.classList.remove('active','green','red','gradient-redviolet','gradient-greenviolet'));
  }
  while(svg.firstChild)svg.removeChild(svg.firstChild);
  predictedEl.textContent='—';predictedEl.className='result-big';dirTextEl.textContent='';
};
window.addEventListener('resize',redrawLines);
chart.addEventListener('scroll',redrawLines);
</script>
</body>
</html>